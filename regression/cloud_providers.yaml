name: streaming-regression-test-cloud-providers
compute:
  cluster: r1z1
gpu_num: 8
command: |-
  pip uninstall -y mosaicml-streaming
  cd streaming
  pip install -e '.[dev]'
  composer -n 1 regression/synthetic_dataset.py --create --cloud gs
  composer -n 2 regression/iterate_data.py --cloud gs --check_download
  composer -n 1 regression/synthetic_dataset.py --delete --cloud gs
  composer -n 1 regression/synthetic_dataset.py --create --cloud s3
  composer -n 4 regression/iterate_data.py --cloud s3 --check_download
  composer -n 1 regression/synthetic_dataset.py --delete --cloud s3
  composer -n 1 regression/synthetic_dataset.py --create --cloud oci
  composer -n 8 regression/iterate_data.py --cloud oci --check_download
  composer -n 1 regression/synthetic_dataset.py --delete --cloud oci

image: mosaicml/composer:0.15.0
scheduling:
  resumable: true
  priority: medium
integrations:
  - integration_type: git_repo
    git_repo: b-chu/streaming
    git_branch: test_cloud_providers
    ssh_clone: false
